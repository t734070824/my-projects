# 多策略加密货币交易信号与监控系统

这是一个基于 Python 的高级加密货币交易辅助工具，旨在通过多策略分析、精细化风险管理和实时通知，为用户提供全面的决策支持。

本系统对接币安(Binance)期货市场，能够同时运行两种互补的交易策略（稳健趋势跟踪 + 激进反转），对多个交易对进行7x24小时不间断分析，并通过钉钉(DingTalk)机器人发送详细的分析报告和实时的交易机会提醒。


## 核心功能



- **双策略分析引擎**:
  - **1. 稳健趋势跟踪策略**: 采用经典的三重时间框架过滤系统（日线、4小时、1小时），结合一个包含多种技术指标（SMA, MACD, RSI, 布林带, 一目均衡表等）的综合评分模型，只在长、中、短周期趋势共振时产生交易信号，以捕捉确定性较高的大趋势。
  - **2. 激进反转策略**: 在短周期（1小时）上运行，专门寻找市场过度延伸的机会。通过监测RSI的极端超买/超卖区域，并结合价格与布林带的关系，来捕捉潜在的短期反转行情（俗称“抄底摸顶”），作为趋势策略的有效补充。

- **精细化风险管理**:
  - **分币种配置**: 允许为不同的交易对（如BTC, ETH）配置独立的风险参数（如开仓风险百分比、ATR止损乘数）。
  - **分策略配置**: 趋势策略和反转策略拥有各自独立的风险配置，允许为更激进的策略设置更小的风险暴露。
  - **动态仓位计算**: 所有虚拟交易的仓位大小均基于账户可用余额、预设风险和动态ATR（平均真实波幅）自动计算，确保风险可控。

- **实时仓位监控**:
  - 一个独立的高频监控进程 (`position_monitor.py`)，不间断地检查您的真实账户持仓。
  - **智能追踪止损**: 当您的持仓产生浮盈时，监控器会自动计算并建议更优的止损位置，帮助您锁定利润。
  - **风险预警**: 能够发现没有设置止损单的“裸仓”，并发出警告。

- **钉钉(DingTalk)实时通知**:
  - **每小时分析报告**: 定时推送一份详细的市场分析报告，内容包括所有监控币种的长期趋势判断、最终决策、ATR值以及潜在的虚拟交易信号。
  - **即时操作建议**: 当监控器发现需要更新追踪止损时，会立即发送通知，提醒您进行手动操作。

- **高度可配置与易于部署**:
  - 所有关键参数，包括API密钥、代理、钉钉机器人、分析的币种列表以及所有策略参数，都在 `config.py` 文件中集中管理，清晰易懂。
  - 提供 `Dockerfile` 和一键部署脚本 `update_and_redeploy.sh`，极大简化了部署和后续更新的流程。

---

## 技术栈

- **核心语言**: Python 3.10+
- **交易所接口**: `ccxt`
- **数据分析**: `pandas`, `pandas-ta`
- **任务调度**: `schedule`
- **HTTP请求**: `requests`
- **容器化**: `Docker`
- **进程管理**: `Supervisord`

---

## 📂 文件结构

```
.
├── app.py                  # 🚀 主程序入口
├── position_monitor.py     # 🛰️ 独立的仓位监控进程
├── signal_generator.py     # 🧠 核心信号生成器
├── config.py               # ⚙️ 所有用户配置项
├── dingtalk_notifier.py    # 🔔 钉钉通知模块
├── requirements.txt        # 📦 Python 依赖库列表
├── Dockerfile              # 🐳 Docker 配置文件
├── supervisord.conf        # 🎛️ 进程管理配置文件
├── update_and_redeploy.sh  # ⚡ 一键部署脚本
└── README.md               # 📖 本说明文件

---

```

## 安装与配置

### 步骤 1: 克隆项目

```bash
git clone https://github.com/your-username/your-repo.git
cd your-repo-folder
```

### 步骤 2: 安装依赖

```bash
pip install -r requirements.txt
```

### 步骤 3: 配置 `config.py` (最重要的一步)

打开 `config.py` 文件，根据注释修改以下内容：

1.  **`DINGTALK_WEBHOOK`**: 填入你的钉钉机器人 Webhook URL。
2.  **`DINGTALK_SECRET`**: (可选) 如果你的机器人使用“加签”安全模式，请填入密钥。
3.  **`API_KEY`**: 填入你的币安 API Key。
4.  **`SECRET_KEY`**: 填入你的币安 Secret Key。
5.  **`PROXY`**: (可选) 如果你需要通过代理访问币安，请设置代理地址。
6.  **`SYMBOLS_TO_ANALYZE`**: 配置你想要监控的交易对列表，例如 `['BTC/USDT', 'ETH/USDT']`。
7.  **`VIRTUAL_TRADE_CONFIG`**: (趋势策略) 按需为不同币种配置风险百分比和ATR止损乘数。
8.  **`REVERSAL_STRATEGY_CONFIG`**: (反转策略) 在这里开启/关闭激进策略，并调整其参数。

---

## 运行方式

### 方法一：本地直接运行

```bash
# 启动主程序 (它会自动在后台启动仓位监控进程)
python app.py
```

### 方法二：使用 Docker (推荐)

确保你已经安装了 Docker。

```bash
# 1. 在项目根目录构建 Docker 镜像
docker build -t buy_sell_sigal .

# 2. 以后台模式启动容器
docker run -d --name buy_sell_sigal_container buy_sell_sigal
```

### 方法三：一键更新与部署

在服务器上，你可以使用 `update_and_redeploy.sh` 脚本来自动完成“拉取最新代码 -> 重新构建镜像 -> 停止旧容器 -> 启动新容器”的整个流程。

```bash
# (首次使用可能需要赋予执行权限)
# chmod +x update_and_redeploy.sh

# 运行脚本
bash update_and_redeploy.sh
```

---

## 策略逻辑详解

### 1. 趋势跟踪策略 (Trend Following)

这是一个多重条件过滤的稳健型策略。

- **决策流程**:
  1.  **战略层面 (1d)**: 使用日线图判断长期趋势方向（看多/看空）。
  2.  **战术层面 (4h)**: 使用4小时图判断中期趋势方向。
  3.  **执行层面 (1h)**: 使用1小时图寻找具体的入场信号 (`STRONG_BUY` / `STRONG_SELL`)。
- **开仓条件**:
  - **做多**: **必须同时满足**：日线看多 **并且** 4小时线看多 **并且** 1小时线出现买入信号。
  - **做空**: **必须同时满足**：日线看空 **并且** 4小时线看空 **并且** 1小时线出现卖出信号。

### 2. 激进反转策略 (Aggressive Reversal)

这是一个高风险高回报的短线策略，默认在1小时图上运行。

- **开仓条件**:
  - **做多 (抄底)**: **必须同时满足**：1小时RSI指标值 **低于** `rsi_oversold` (默认为28) **并且** 当前价格 **触及或跌破** 布林带下轨。
  - **做空 (摸顶)**: **必须同时满足**：1小时RSI指标值 **高于** `rsi_overbought` (默认为72) **并且** 当前价格 **触及或突破** 布林带上轨。

---

## 免责声明

- 本项目提供的所有代码和信号仅为量化分析学习与研究之用，不构成任何投资建议。
- 加密货币市场波动剧烈，风险极高。任何据此进行的真实交易操作，风险由用户自行承担。
- 在进行真实交易前，请务必充分理解代码逻辑，并进行充分的回测和模拟。
- **请务必妥善保管您的 API Key 和 Secret Key，切勿泄露给他人。**
