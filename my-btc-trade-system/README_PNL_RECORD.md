# 盈亏记录功能说明

## 功能概述

系统现在支持自动记录账户未实现盈亏，并在钉钉推送中展示盈亏统计信息和走势图。

## 主要功能

### 1. 自动记录盈亏
- 每分钟自动记录当前账户未实现盈亏
- 记录包含：时间戳、盈亏金额、盈亏比例、总余额
- 自动清理过期记录（默认保留24小时）

### 2. 盈亏统计
- 显示当前盈亏
- 显示历史最高盈亏及时间
- 显示历史最低盈亏及时间
- 显示记录总数

### 3. 走势图显示
- 生成文本格式的盈亏走势图
- 显示最近100个数据点
- 图表高度10行，宽度最多50列
- 时间轴显示分钟信息

## 配置参数

在 `config.py` 中可以调整以下参数：

```python
# 盈亏记录配置
PNL_RECORD_INTERVAL = 60  # 记录间隔（秒），默认60秒
PNL_RECORD_MAX_HOURS = 24  # 最大记录小时数，默认24小时
PNL_RECORD_FILE = "pnl_history.json"  # 盈亏记录文件
```

## 钉钉通知内容

钉钉通知现在包含以下新增内容：

```
🚨 币安交易提醒 🚨
时间: 2024-01-15 14:30:00

💰 盈亏统计:
   当前盈亏: 123.45U
   最高盈亏: 150.20U (2024-01-15 13:45:00)
   最低盈亏: 95.80U (2024-01-15 12:15:00)
   记录数量: 45条

📊 盈亏走势图:
==================================================
  150.20 |
         |                    ●
  140.00 |                ●
         |            ●
  130.00 |        ●
         |    ●
  120.00 |●
         |
  110.00 |
         |
  100.00 |
         |
   90.00 |
         |
        |45 47 49 51 53 55 57 59 01 03 05
==================================================
```

## 数据存储

- 盈亏数据存储在 `pnl_history.json` 文件中
- 文件格式为JSON，包含时间戳、盈亏金额等信息
- 自动清理过期数据，避免文件过大

## 测试功能

运行测试脚本验证功能：

```bash
python test_pnl_record.py
```

## 注意事项

1. 确保API密钥配置正确，否则无法获取账户信息
2. 盈亏记录文件会自动创建，无需手动创建
3. 图表显示会根据数据量自动调整
4. 系统会自动处理文件读写异常

## 文件结构

```
my-btc-trade-system/
├── main.py              # 主程序（包含盈亏记录功能）
├── config.py            # 配置文件
├── api_keys.py          # API密钥
├── test_pnl_record.py   # 测试脚本
├── pnl_history.json     # 盈亏记录文件（自动生成）
└── .gitignore           # Git忽略文件
``` 